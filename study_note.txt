Time: 0ms
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
pilot.service.ts (runPilot):
  for (subtask of [A, B, C, D, E]) {
    skillService.sendInvokeSkillTask(subtask);  // Non-blocking!
  }
  
  âœ… Loop completes in ~50ms (just DB writes + queue adds)
  âœ… Session status â†’ 'waiting'

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Time: 50ms - BullMQ Queue State:
  
  Redis Queue:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Job 1: Subtask A (status: waiting)                  â”‚
  â”‚ Job 2: Subtask B (status: waiting)                  â”‚
  â”‚ Job 3: Subtask C (status: waiting)                  â”‚
  â”‚ Job 4: Subtask D (status: waiting)                  â”‚
  â”‚ Job 5: Subtask E (status: waiting)                  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Time: 100ms - Worker Pool Picks Up Jobs:
  
  Worker Pool (concurrency: 20):
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Worker 1: Processing Job 1 (Subtask A) â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     â”‚
  â”‚ Worker 2: Processing Job 2 (Subtask B) â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     â”‚
  â”‚ Worker 3: Processing Job 3 (Subtask C) â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     â”‚
  â”‚ Worker 4: Processing Job 4 (Subtask D) â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     â”‚
  â”‚ Worker 5: Processing Job 5 (Subtask E) â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     â”‚
  â”‚ Worker 6-20: Idle                                    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  
  âœ… All 5 subtasks executing in parallel!

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Time: 5000ms - First Subtask Completes:
  
  Subtask B finishes first:
    â†“
  skill-invoker.service.ts updates DB:
    actionResult.status = 'finish'
    pilotStep.status = 'finish'
    â†“
  Triggers syncPilotStep(step_B):
    â†“
  Checks: Are ALL subtasks finished?
    â†’ A: executing âŒ
    â†’ B: finish âœ…
    â†’ C: executing âŒ
    â†’ D: executing âŒ
    â†’ E: executing âŒ
    â†“
  Result: NO â†’ Do nothing, keep waiting

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Time: 12000ms - Last Subtask Completes:
  
  Subtask D finishes last:
    â†“
  Triggers syncPilotStep(step_D):
    â†“
  Checks: Are ALL subtasks finished?
    â†’ A: finish âœ…
    â†’ B: finish âœ…
    â†’ C: finish âœ…
    â†’ D: finish âœ…
    â†’ E: finish âœ…
    â†“
  Result: YES! â†’ Advance to next epoch
    â†“
  prisma.pilotSession.update({
    currentEpoch: 1,  // Stage 2
    status: 'executing'
  });
    â†“
  runPilotQueue.add('runPilot', {
    sessionId,
    mode: 'subtask'
  });
    â†“
  ğŸ‰ Stage 2 begins!








Time: 0ms - Initial Plan Creation
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Database State:
  pilotSession:
    sessionId: "session-123"
    currentEpoch: 0
    maxEpoch: 3
    status: "executing"
    progress: {
      stages: [
        { name: "Stage 1", status: "in_progress", subtasks: [...] },
        { name: "Stage 2", status: "pending", subtasks: [...] },
        { name: "Stage 3", status: "pending", subtasks: [...] }
      ]
    }

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Time: 100ms - Create Subtask Records
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Database State:
  pilotStep:
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ stepId: "step-1", epoch: 0, status: "executing"     â”‚
    â”‚ stepId: "step-2", epoch: 0, status: "executing"     â”‚
    â”‚ stepId: "step-3", epoch: 0, status: "executing"     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  
  pilotSession:
    status: "waiting"  â† Changed from "executing"

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Time: 5000ms - First Subtask Completes
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Update ActionResult:
   resultId: "result-1", status: "finish", output: "{...}"

2. Update PilotStep:
   stepId: "step-1", status: "finish"

3. Trigger syncPilotStep("step-1"):
   
   Query database:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ step-1: status = "finish"   âœ…                      â”‚
   â”‚ step-2: status = "executing" â³                     â”‚
   â”‚ step-3: status = "executing" â³                     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   
   Check: allFinished = false
   Action: Do nothing, keep waiting

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Time: 12000ms - Last Subtask Completes
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Update PilotStep:
   stepId: "step-3", status: "finish"

2. Trigger syncPilotStep("step-3"):
   
   Query database:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ step-1: status = "finish"   âœ…                      â”‚
   â”‚ step-2: status = "finish"   âœ…                      â”‚
   â”‚ step-3: status = "finish"   âœ…                      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   
   Check: allFinished = true âœ…
   Check: reachedMaxEpoch = false (epoch 0 < maxEpoch 3)
   
   Action: Move to next stage
   
3. Update pilotSession:
   currentEpoch: 1  â† Incremented from 0
   status: "executing"

4. Queue next stage:
   runPilotQueue.add('runPilot', { sessionId, mode: 'subtask' })

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Time: 12100ms - Update Progress Plan
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. Pull plan from database:
   progressPlan = JSON.parse(session.progress)

2. Update Stage 1 status:
   stages[0].status = "completed"
   stages[0].stageProgress = 100
   stages[0].completedAt = "2025-12-31T10:00:12Z"

3. Update Stage 2 status:
   stages[1].status = "in_progress"
   stages[1].startedAt = "2025-12-31T10:00:12Z"

4. Calculate overall progress:
   overallProgress = (1 / 3) * 100 = 33.33%

5. Save back to database:
   await prisma.pilotSession.update({
     where: { sessionId },
     data: {
       progress: JSON.stringify(progressPlan)  â† Updated!
     }
   });

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Time: 12200ms - Execute Stage 2 Subtasks
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Repeat the cycle for Stage 2...






ç”¨æˆ·è¾“å…¥ "å¸®æˆ‘æœç´¢å¹¶åˆ†æè¿™ä¸ªè¯é¢˜"
    â†“
[1] LLMåˆ†ææ„å›¾ â†’ toolCategories: ["search", "web", "analysis"]
    â†“
[2] è¿‡æ»¤å·¥å…·é›† â†’ åªä¿ç•™æœç´¢å’Œåˆ†æç›¸å…³å·¥å…·
    â†“
[3] ç”Ÿæˆå­ä»»åŠ¡ â†’ å­ä»»åŠ¡1: "æœç´¢è¯é¢˜", å­ä»»åŠ¡2: "åˆ†æç»“æœ"
    â†“
[4] å¹¶å‘æ‰§è¡Œå­ä»»åŠ¡ (BullMQé˜Ÿåˆ—,20ä¸ªworker)
    â†“
[5] æ¯ä¸ªå­ä»»åŠ¡:
    - å®ä¾‹åŒ–ç›¸å…³å·¥å…·
    - ç»‘å®šåˆ°LLM (tool_choice="auto")
    - LLMè‡ªä¸»å†³å®šè°ƒç”¨å“ªä¸ªå·¥å…·
    - é¡ºåºæ‰§è¡Œå·¥å…·è°ƒç”¨
    - è¿”å›ç»“æœ
    â†“
[6] æ±‡æ€»æ‰€æœ‰å­ä»»åŠ¡ç»“æœ â†’ è¿”å›ç»™ç”¨æˆ·