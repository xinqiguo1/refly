global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    cluster: 'refly-local'
    environment: 'development'

# ============================================================================
# 抓取配置
# ============================================================================
scrape_configs:
  # --------------------------------------------------------------------------
  # Refly API Metrics (via OTEL Collector - with Exemplars)
  #
  # 说明：
  #   - 来源：Refly API 通过 OTEL Collector 暴露的指标
  #   - 指标：llm_*, tool_*, db_*, http_*, process_* 等业务指标
  #   - 格式：OpenMetrics (支持 Exemplars)
  #   - 用途：核心业务监控 + Trace 关联
  # --------------------------------------------------------------------------
  - job_name: 'reflyd'
    scrape_interval: 15s
    static_configs:
      - targets: ['otel-collector:8889']

  # --------------------------------------------------------------------------
  # Prometheus 自身监控 (本地环境保留，便于调试)
  #
  # 说明：
  #   - 来源：Prometheus 服务器自己 (Go 语言编写)
  #   - 指标：go_* (29个), prometheus_* (176个)
  #   - 用途：监控 Prometheus 服务器的健康状态
  #   - 占比：约 70% metrics
  #
  # 生产环境建议：
  #   如果只关注业务应用监控，注释掉此 job 即可
  #   (节省 ~200MB/月 存储，减少 205 个指标)
  # --------------------------------------------------------------------------
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  # --------------------------------------------------------------------------
  # OTEL Collector 监控
  #
  # 说明：
  #   - 来源：OpenTelemetry Collector (Go 语言编写)
  #   - 指标：otelcol_* (数据管道健康)
  #   - 已过滤：go_* (避免与 Prometheus 的 go_* 重复)
  # --------------------------------------------------------------------------
  - job_name: 'otel-collector'
    static_configs:
      - targets: ['otel-collector:8888']
    metric_relabel_configs:
      - source_labels: [__name__]
        regex: 'go_.*'
        action: drop

# ============================================================================
# 生产环境过滤示例 (注释掉 prometheus job 即可)
# ============================================================================
# scrape_configs:
#   # 生产环境：注释掉 Prometheus 自抓取，仅保留业务指标
#   # - job_name: 'prometheus'
#   #   static_configs:
#   #     - targets: ['localhost:9090']
#
#   - job_name: 'otel-collector'
#     static_configs:
#       - targets: ['otel-collector:8888']
#     metric_relabel_configs:
#       - source_labels: [__name__]
#         regex: 'go_.*'
#         action: drop
# ============================================================================
